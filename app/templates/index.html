<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Document Processing & Insights Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">Smart Document Processing & Insights Platform</h1>
            <p class="text-gray-600">Upload your documents for AI-powered analysis and insights</p>
        </header>

        <div class="max-w-4xl mx-auto">
            <!-- Upload Form -->
            <div class="bg-white rounded-lg shadow-md p-8 mb-8">
                <form id="uploadForm" class="space-y-6">
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                        <input type="file" id="fileInput" name="file" accept=".pdf,.jpg,.jpeg,.png" class="hidden">
                        <label for="fileInput" class="cursor-pointer">
                            <div class="space-y-2">
                                <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                    <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                                <div class="text-gray-600">
                                    <span class="font-medium">Click to upload</span> or drag and drop
                                </div>
                                <p class="text-xs text-gray-500">PDF, JPG, PNG (Max 10MB)</p>
                            </div>
                        </label>
                    </div>

                    <div id="filePreview" class="hidden">
                        <div class="flex items-center p-4 bg-gray-50 rounded">
                            <svg class="h-6 w-6 text-gray-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <span id="fileName" class="text-sm text-gray-600"></span>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                        Process Document
                    </button>
                </form>
            </div>

            <!-- Processing Status -->
            <div id="processingStatus" class="hidden bg-white rounded-lg shadow-md p-6 mb-8">
                <div class="animate-pulse flex space-x-4">
                    <div class="flex-1 space-y-4 py-1">
                        <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                        <div class="space-y-2">
                            <div class="h-4 bg-gray-200 rounded"></div>
                            <div class="h-4 bg-gray-200 rounded w-5/6"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden space-y-8">
                <!-- Document Info -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Document Information</h2>
                    <div id="documentInfo" class="space-y-2"></div>
                </div>

                <!-- Summary -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Document Summary</h2>
                    <div id="summaryContent" class="prose max-w-none"></div>
                </div>

                <!-- Sentiment Analysis -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Content Analysis</h2>
                    <div id="sentimentContent" class="space-y-2"></div>
                </div>

                <!-- Download Report -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Generated Report</h2>
                    <div id="downloadSection" class="flex items-center justify-between">
                        <p class="text-gray-600">Download the complete analysis report in PDF format</p>
                        <a id="downloadLink" href="#" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            Download Report
                        </a>
                    </div>
                </div>

                <!-- Chat Interface -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Chat with Your Document</h2>
                    <div id="chatMessages" class="space-y-4 h-96 overflow-y-auto mb-4 p-4 border border-gray-200 rounded-lg">
                        <div class="text-center text-gray-500">
                            Ask questions about your document and get AI-powered responses
                        </div>
                    </div>
                    <form id="chatForm" class="flex gap-2">
                        <input type="text" id="chatInput" 
                               class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                               placeholder="Ask a question about your document...">
                        <button type="submit" 
                                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors">
                            Send
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('uploadForm');
        const fileInput = document.getElementById('fileInput');
        const filePreview = document.getElementById('filePreview');
        const fileName = document.getElementById('fileName');
        const processingStatus = document.getElementById('processingStatus');
        const resultsSection = document.getElementById('resultsSection');
        const documentInfo = document.getElementById('documentInfo');
        const summaryContent = document.getElementById('summaryContent');
        const sentimentContent = document.getElementById('sentimentContent');
        const downloadLink = document.getElementById('downloadLink');
        const chatForm = document.getElementById('chatForm');
        const chatInput = document.getElementById('chatInput');
        const chatMessages = document.getElementById('chatMessages');
        let currentDocumentId = null;

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                fileName.textContent = file.name;
                filePreview.classList.remove('hidden');
            }
        });

        function displayResults(data) {
            // Store document ID for chat
            currentDocumentId = data.document_id;
            
            // Display document info
            const metadataHtml = Object.entries(data.metadata)
                .filter(([key, value]) => value) // Only show non-empty values
                .map(([key, value]) => `
                    <div class="flex justify-between py-2 border-b border-gray-200">
                        <span class="font-medium text-gray-600">${key.replace('_', ' ').toUpperCase()}</span>
                        <span class="text-gray-800">${value}</span>
                    </div>
                `).join('');
            documentInfo.innerHTML = metadataHtml;

            // Display summary
            summaryContent.innerHTML = `<p class="text-gray-800">${data.summary}</p>`;

            // Display sentiment
            sentimentContent.innerHTML = `
                <div class="mb-4">
                    <span class="font-medium text-gray-600">Overall Sentiment:</span>
                    <span class="ml-2 text-gray-800">${data.sentiment}</span>
                </div>
            `;

            // Update download link
            downloadLink.href = `/report/${data.report_filename}`;
            downloadLink.setAttribute('download', data.report_filename);

            // Show results section
            resultsSection.classList.remove('hidden');
            
            // Clear previous chat messages
            chatMessages.innerHTML = '<div class="text-center text-gray-500">Ask questions about your document and get AI-powered responses</div>';
        }

        async function handleChat(question) {
            if (!currentDocumentId) {
                appendMessage('Please upload a document first.', false);
                return;
            }

            try {
                const response = await fetch('/chat/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        question: question,
                        document_id: currentDocumentId
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    appendMessage(result.response, false);
                } else {
                    appendMessage(`Error: ${result.detail || 'Something went wrong'}`, false);
                }
            } catch (error) {
                appendMessage('Sorry, there was an error communicating with the server.', false);
                console.error('Chat error:', error);
            }
        }

        function appendMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'} mb-4`;
            
            const messageBubble = document.createElement('div');
            messageBubble.className = `max-w-3/4 p-4 rounded-lg ${
                isUser 
                    ? 'bg-blue-600 text-white rounded-br-none' 
                    : 'bg-gray-100 text-gray-800 rounded-bl-none'
            }`;
            
            messageBubble.textContent = content;
            messageDiv.appendChild(messageBubble);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            // Show processing status
            processingStatus.classList.remove('hidden');
            resultsSection.classList.add('hidden');

            try {
                const response = await fetch('/upload/', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok) {
                    displayResults(result);
                } else {
                    alert('Error: ' + result.detail);
                }
            } catch (error) {
                alert('Error uploading file: ' + error.message);
            } finally {
                processingStatus.classList.add('hidden');
            }
        });

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const question = chatInput.value.trim();
            
            if (question) {
                appendMessage(question, true);
                chatInput.value = '';
                await handleChat(question);
            }
        });
    </script>
</body>
</html> 